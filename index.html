<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMART Q - Queue Management Dashboard (Local Login)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
        }
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 40;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.5rem;
            width: 90%;
            max-width: 500px;
            z-index: 50;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .sidebar-icon {
            width: 24px;
            height: 24px;
        }
        .card-icon {
            width: 80px;
            height: 80px;
        }
    </style>
</head>
<body class="h-screen">

    <!-- Auth View (Login/Signup) -->
    <div id="auth-view" class="flex items-center justify-center h-full bg-gray-100">
        <div class="w-full max-w-md p-8 space-y-8 bg-white rounded-lg shadow-md">
            <div>
                <h2 class="text-3xl font-extrabold text-center text-gray-900">SMART Q</h2>
                <p id="auth-mode-title" class="mt-2 text-center text-sm text-gray-600">Sign in to your account</p>
            </div>
            
            <div id="auth-error-display" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg" role="alert">
                <p id="auth-error-message"></p>
            </div>

            <form id="login-form" class="mt-8 space-y-6">
                <div class="rounded-md shadow-sm -space-y-px">
                    <div>
                        <label for="login-email-address" class="sr-only">Email address</label>
                        <input id="login-email-address" name="email" type="email" autocomplete="email" required class="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="Email address">
                    </div>
                    <div>
                        <label for="login-password" class="sr-only">Password</label>
                        <input id="login-password" name="password" type="password" autocomplete="current-password" required class="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="Password">
                    </div>
                </div>
                <div>
                    <button type="submit" class="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">Sign in</button>
                </div>
            </form>

            <form id="signup-form" class="hidden mt-8 space-y-6">
                 <div class="rounded-md shadow-sm -space-y-px">
                    <div>
                        <label for="signup-email-address" class="sr-only">Email address</label>
                        <input id="signup-email-address" name="email" type="email" autocomplete="email" required class="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="Email address">
                    </div>
                    <div>
                        <label for="signup-password" class="sr-only">Password</label>
                        <input id="signup-password" name="password" type="password" autocomplete="new-password" required class="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="Password (min. 6 characters)">
                    </div>
                </div>
                <div>
                    <button type="submit" class="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">Sign up</button>
                </div>
            </form>

            <p class="mt-2 text-center text-sm text-gray-600">
                <a href="#" id="toggle-auth-mode" class="font-medium text-indigo-600 hover:text-indigo-500">Don't have an account? Sign up</a>
            </p>
        </div>
    </div>

    <!-- Main App View -->
    <div id="app-view" class="hidden flex h-screen w-full">
        <!-- Sidebar -->
        <aside class="w-64 bg-gray-800 text-white flex flex-col p-4">
            <div class="text-2xl font-bold mb-10">SMART Q</div>
            <nav class="flex flex-col space-y-2">
                <a href="#" id="nav-dashboard" class="flex items-center space-x-3 p-2 rounded-md bg-gray-700">
                    <svg class="sidebar-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
                    <span>Dashboard</span>
                </a>
                <a href="#" id="nav-history" class="flex items-center space-x-3 p-2 rounded-md hover:bg-gray-700">
                     <svg class="sidebar-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                    <span>History</span>
                </a>
                <a href="#" id="nav-settings" class="flex items-center space-x-3 p-2 rounded-md hover:bg-gray-700">
                    <svg class="sidebar-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                    <span>Settings</span>
                </a>
                <a href="#" id="logout-btn" class="flex items-center space-x-3 p-2 rounded-md hover:bg-gray-700">
                    <svg class="sidebar-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>
                    <span>Logout</span>
                </a>
            </nav>
            <div id="user-info-container" class="mt-auto p-2 border-t border-gray-700 text-xs">
                <p class="font-semibold">Logged in as:</p>
                <p id="user-email-display" class="break-all"></p>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-6 md:p-10 overflow-y-auto">
            <!-- Dashboard View -->
            <div id="dashboard-view">
                <h1 class="text-3xl font-bold text-gray-800 mb-8">Dashboard</h1>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <!-- Cards -->
                    <div class="bg-blue-100 p-6 rounded-lg shadow-md flex flex-col items-center text-center"><div class="card-icon text-blue-500 mb-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M19 8H5a3 3 0 00-3 3v2a3 3 0 003 3h1v2a2 2 0 002 2h8a2 2 0 002-2v-2h1a3 3 0 003-3v-2a3 3 0 00-3-3zm-9 8V9h2v7H10zm4 0V9h2v7h-2z"/></svg></div><h2 class="text-xl font-bold mb-2">HOSPITAL</h2><p class="text-gray-600 mb-4">Manage patient queue and appointments.</p><button id="add-patient-btn" class="bg-blue-500 text-white px-6 py-2 rounded-md hover:bg-blue-600 transition">Add Patient</button></div>
                    <div class="bg-orange-100 p-6 rounded-lg shadow-md flex flex-col items-center text-center"><div class="card-icon text-orange-500 mb-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M20 3H4a1 1 0 00-1 1v2a1 1 0 001 1h16a1 1 0 001-1V4a1 1 0 00-1-1zM4 9h16v11a1 1 0 01-1 1H5a1 1 0 01-1-1V9zm2 2v2h2v-2H6zm4 0v2h2v-2h-2zm4 0v2h2v-2h-2z"/></svg></div><h2 class="text-xl font-bold mb-2">RESTAURANT</h2><p class="text-gray-600 mb-4">Manage table reservations.</p><button id="add-reservation-btn" class="bg-orange-500 text-white px-6 py-2 rounded-md hover:bg-orange-600 transition">Add Reservation</button></div>
                    <div class="bg-green-100 p-6 rounded-lg shadow-md flex flex-col items-center text-center"><div class="card-icon text-green-500 mb-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L2 7v2h20V7L12 2zM4 10v9h2v-4h2v4h4v-7h2v7h4v-4h2v4h2v-9H4z"/></svg></div><h2 class="text-xl font-bold mb-2">BANK</h2><p class="text-gray-600 mb-4">Manage customer service queue.</p><button id="add-customer-btn" class="bg-green-500 text-white px-6 py-2 rounded-md hover:bg-green-600 transition">Add Customer</button></div>
                </div>
            </div>

            <!-- History View -->
            <div id="history-view" class="hidden"><h1 class="text-3xl font-bold text-gray-800 mb-8">History</h1><div class="space-y-6"><div><h2 class="text-2xl font-semibold mb-4 text-blue-700">Patient History</h2><div id="patient-history-list" class="bg-white p-4 rounded-lg shadow-md">No patient records found.</div></div><div><h2 class="text-2xl font-semibold mb-4 text-orange-700">Reservation History</h2><div id="reservation-history-list" class="bg-white p-4 rounded-lg shadow-md">No reservation records found.</div></div><div><h2 class="text-2xl font-semibold mb-4 text-green-700">Bank Customer History</h2><div id="customer-history-list" class="bg-white p-4 rounded-lg shadow-md">No customer records found.</div></div></div></div>
            <!-- Settings View -->
            <div id="settings-view" class="hidden"><h1 class="text-3xl font-bold text-gray-800 mb-8">Settings</h1><div class="bg-white p-6 rounded-lg shadow-md max-w-md"><h2 class="text-2xl font-semibold mb-4">Data Management</h2><p class="text-gray-600 mb-4">All data is stored in your browser's local storage. Clearing your browser data will permanently delete all records for all users.</p><button id="clear-data-btn" class="w-full bg-red-600 text-white px-6 py-2 rounded-md hover:bg-red-700 transition">Clear All Data</button></div></div>
        </main>
    </div>

    <!-- Modals -->
    <div id="modal-container"></div>
    <!-- Toast Notification -->
    <div id="toast" class="hidden fixed bottom-5 right-5 bg-gray-900 text-white px-6 py-3 rounded-lg shadow-lg"><p id="toast-message"></p></div>

    <script>
        // --- UI ELEMENTS ---
        const authView = document.getElementById('auth-view');
        const appView = document.getElementById('app-view');
        const loginForm = document.getElementById('login-form');
        const signupForm = document.getElementById('signup-form');
        const toggleAuthLink = document.getElementById('toggle-auth-mode');
        const authModeTitle = document.getElementById('auth-mode-title');
        const authErrorDisplay = document.getElementById('auth-error-display');
        const authErrorMessage = document.getElementById('auth-error-message');
        const logoutBtn = document.getElementById('logout-btn');
        const userEmailDisplay = document.getElementById('user-email-display');
        const views = { dashboard: document.getElementById('dashboard-view'), history: document.getElementById('history-view'), settings: document.getElementById('settings-view') };
        const navLinks = { dashboard: document.getElementById('nav-dashboard'), history: document.getElementById('nav-history'), settings: document.getElementById('nav-settings') };
        const modalContainer = document.getElementById('modal-container');
        const clearDataBtn = document.getElementById('clear-data-btn');

        // --- LOCAL AUTHENTICATION LOGIC ---
        const USERS_KEY = 'smartq_users';
        const SESSION_KEY = 'smartq_session';
        let currentUser = null;

        function showAuthError(message) {
            authErrorMessage.textContent = message;
            authErrorDisplay.classList.remove('hidden');
        }

        function handleLogin(email) {
            currentUser = email;
            sessionStorage.setItem(SESSION_KEY, email);
            authView.classList.add('hidden');
            appView.classList.remove('hidden');
            appView.classList.add('flex');
            userEmailDisplay.textContent = currentUser;
            loadAllDataForCurrentUser();
            switchView('dashboard');
        }

        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = loginForm.email.value;
            const password = loginForm.password.value;
            const users = JSON.parse(localStorage.getItem(USERS_KEY) || '[]');
            const user = users.find(u => u.email === email && u.password === password);
            if (user) {
                handleLogin(email);
            } else {
                showAuthError('Invalid email or password.');
            }
        });

        signupForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = signupForm.email.value;
            const password = signupForm.password.value;
            if (password.length < 6) {
                showAuthError('Password should be at least 6 characters.');
                return;
            }
            let users = JSON.parse(localStorage.getItem(USERS_KEY) || '[]');
            if (users.some(u => u.email === email)) {
                showAuthError('An account with this email already exists.');
                return;
            }
            users.push({ email, password });
            localStorage.setItem(USERS_KEY, JSON.stringify(users));
            handleLogin(email);
        });

        logoutBtn.addEventListener('click', (e) => {
            e.preventDefault();
            currentUser = null;
            sessionStorage.removeItem(SESSION_KEY);
            authView.classList.remove('hidden');
            appView.classList.add('hidden');
            appView.classList.remove('flex');
        });

        toggleAuthLink.addEventListener('click', (e) => {
            e.preventDefault();
            const isLogin = loginForm.classList.contains('hidden');
            if (isLogin) {
                loginForm.classList.remove('hidden'); signupForm.classList.add('hidden');
                authModeTitle.textContent = 'Sign in to your account';
                toggleAuthLink.textContent = 'Don\'t have an account? Sign up';
            } else {
                loginForm.classList.add('hidden'); signupForm.classList.remove('hidden');
                authModeTitle.textContent = 'Create a new account';
                toggleAuthLink.textContent = 'Already have an account? Sign in';
            }
            authErrorDisplay.classList.add('hidden');
        });

        // --- NAVIGATION & UI ---
        function switchView(viewName) {
            Object.values(views).forEach(view => view.classList.add('hidden'));
            Object.values(navLinks).forEach(link => link.classList.remove('bg-gray-700'));
            if (views[viewName]) views[viewName].classList.remove('hidden');
            if (navLinks[viewName]) navLinks[viewName].classList.add('bg-gray-700');
        }
        navLinks.dashboard.addEventListener('click', (e) => { e.preventDefault(); switchView('dashboard'); });
        navLinks.history.addEventListener('click', (e) => { e.preventDefault(); switchView('history'); });
        navLinks.settings.addEventListener('click', (e) => { e.preventDefault(); switchView('settings'); });
        
        function createModal(title, formHtml, submitHandler) {
            const modalId = `modal-${Date.now()}`;
            const modalBackdrop = document.createElement('div');
            modalBackdrop.className = 'modal-backdrop'; modalBackdrop.id = modalId;
            modalBackdrop.innerHTML = `<div class="modal-content" onclick="event.stopPropagation();"><h2 class="text-2xl font-bold mb-6">${title}</h2><form id="modal-form">${formHtml}<div class="flex justify-end space-x-4 mt-8"><button type="button" class="cancel-btn px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">Cancel</button><button type="submit" class="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600">Save</button></div></form></div>`;
            modalContainer.appendChild(modalBackdrop);
            modalBackdrop.querySelector('.cancel-btn').addEventListener('click', () => closeModal(modalId));
            modalBackdrop.querySelector('#modal-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const data = Object.fromEntries(new FormData(e.target).entries());
                submitHandler(data);
                closeModal(modalId);
            });
        }
        function closeModal(modalId) { const modal = document.getElementById(modalId); if (modal) modal.remove(); }
        function showToast(message) { const toast = document.getElementById('toast'), msg = document.getElementById('toast-message'); msg.textContent = message; toast.classList.remove('hidden'); setTimeout(() => toast.classList.add('hidden'), 3000); }

        // --- FORM DEFINITIONS & EVENT LISTENERS ---
        document.getElementById('add-patient-btn').addEventListener('click', () => {
            createModal('Add New Patient', `
                <div class="space-y-4">
                    <div><label class="block text-sm font-medium text-gray-700">Patient Name</label><input type="text" name="name" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"></div>
                    <div><label class="block text-sm font-medium text-gray-700">Medical Issue</label><input type="text" name="issue" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"></div>
                    <div><label class="block text-sm font-medium text-gray-700">Appointment Date</label><input type="datetime-local" name="appointmentDate" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"></div>
                </div>
            `, (data) => saveData('patients', data));
        });

        document.getElementById('add-reservation-btn').addEventListener('click', () => {
            createModal('Add New Reservation', `
                <div class="space-y-4">
                    <div><label class="block text-sm font-medium text-gray-700">Customer Name</label><input type="text" name="name" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500"></div>
                    <div><label class="block text-sm font-medium text-gray-700">Party Size</label><input type="number" name="partySize" min="1" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500"></div>
                    <div><label class="block text-sm font-medium text-gray-700">Reservation Time</label><input type="datetime-local" name="reservationTime" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500"></div>
                </div>
            `, (data) => saveData('restaurants', data));
        });

        document.getElementById('add-customer-btn').addEventListener('click', () => {
            createModal('Add New Bank Customer', `
                <div class="space-y-4">
                    <div><label class="block text-sm font-medium text-gray-700">Customer Name</label><input type="text" name="name" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500"></div>
                    <div><label class="block text-sm font-medium text-gray-700">Service Required</label><input type="text" name="service" placeholder="e.g., Deposit, Withdrawal" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500"></div>
                </div>
            `, (data) => saveData('banks', data));
        });
        
        // --- DATA STORAGE (USER-SPECIFIC) ---
        const collections = { patients: 'patients', restaurants: 'reservations', banks: 'customers' };
        function getUserDataKey(collectionName) { return `smartq_${collectionName}_${currentUser}`; }

        function saveData(collectionName, data) {
            const key = getUserDataKey(collections[collectionName]);
            let items = JSON.parse(localStorage.getItem(key) || '[]');
            items.push({ ...data, id: `id_${Date.now()}`, createdAt: new Date().toISOString() });
            localStorage.setItem(key, JSON.stringify(items));
            showToast(`${collectionName.slice(0, -1)} added successfully!`);
            loadAllDataForCurrentUser();
        }

        function loadAllDataForCurrentUser() {
            if (!currentUser) return;
            Object.keys(collections).forEach(name => {
                const key = getUserDataKey(collections[name]);
                const listElId = `${collections[name].slice(0, -1)}-history-list`;
                const listEl = document.getElementById(listElId);
                const items = JSON.parse(localStorage.getItem(key) || '[]');
                items.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                renderHistoryList(listEl, items, name);
            });
        }

        function renderHistoryList(element, items, type) {
            if (!items || items.length === 0) {
                element.innerHTML = `<p class="p-4 text-gray-500">No records found.</p>`;
                return;
            }
            element.innerHTML = '';
            const list = document.createElement('ul');
            list.className = 'space-y-3';
            items.forEach(item => {
                const li = document.createElement('li');
                li.className = 'p-3 bg-gray-50 rounded-md border border-gray-200';
                let content = `<p class="font-semibold text-gray-800">${item.name}</p>`;
                if (type === 'patients') content += `<p class="text-sm text-gray-600">Issue: ${item.issue}</p><p class="text-sm text-gray-500">Appointment: ${new Date(item.appointmentDate).toLocaleString()}</p>`;
                else if (type === 'restaurants') content += `<p class="text-sm text-gray-600">Party Size: ${item.partySize}</p><p class="text-sm text-gray-500">Reservation: ${new Date(item.reservationTime).toLocaleString()}</p>`;
                else if (type === 'banks') content += `<p class="text-sm text-gray-600">Service: ${item.service}</p>`;
                if (item.createdAt) content += `<p class="text-xs text-gray-400 mt-1">Added: ${new Date(item.createdAt).toLocaleString()}</p>`;
                li.innerHTML = content;
                list.appendChild(li);
            });
            element.appendChild(list);
        }

        clearDataBtn.addEventListener('click', () => {
             if (confirm("Are you sure you want to delete all data for all users? This cannot be undone.")) {
                localStorage.clear(); // Clears everything
                loadAllDataForCurrentUser();
                showToast("All application data has been cleared.");
            }
        });

        // --- INITIAL APP LOAD ---
        function initializeApp() {
            const loggedInUser = sessionStorage.getItem(SESSION_KEY);
            if (loggedInUser) {
                handleLogin(loggedInUser);
            } else {
                authView.classList.remove('hidden');
                appView.classList.add('hidden');
            }
        }
        initializeApp();
    </script>
</body>
</html>
